访问者模式是一种行为设计模式， 它能将算法与其所作用的对象隔离开来。

![[访问者模式现实世界类别.png]]

## 结构
![[访问者模式结构.png]]

## 适用场景
如果你需要对一个复杂对象结构 （例如对象树） 中的所有元素执行某些操作， 可使用访问者模式。

可使用访问者模式来清理辅助行为的业务逻辑。

当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式。
## 实现方式
在访问者接口中声明一组 “访问” 方法， 分别对应程序中的每个具体元素类。

声明元素接口。 如果程序中已有元素类层次接口， 可在层次结构基类中添加抽象的 “接收” 方法。 该方法必须接受访问者对象作为参数。

在所有具体元素类中实现接收方法。 这些方法必须将调用重定向到当前元素对应的访问者对象中的访问者方法上。

元素类只能通过访问者接口与访问者进行交互。 不过访问者必须知晓所有的具体元素类， 因为这些类在访问者方法中都被作为参数类型引用。

为每个无法在元素层次结构中实现的行为创建一个具体访问者类并实现所有的访问者方法。

你可能会遇到访问者需要访问元素类的部分私有成员变量的情况。 在这种情况下， 你要么将这些变量或方法设为公有， 这将破坏元素的封装； 要么将访问者类嵌入到元素类中。 后一种方式只有在支持嵌套类的编程语言中才可能实现。

客户端必须创建访问者对象并通过 “接收” 方法将其传递给元素。
## 优点
开闭原则。 你可以引入在不同类对象上执行的新行为， 且无需对这些类做出修改。

单一职责原则。 可将同一行为的不同版本移到同一个类中。

访问者对象可以在与各种对象交互时收集一些有用的信息。 当你想要遍历一些复杂的对象结构 （例如对象树）， 并在结构中的每个对象上应用访问者时， 这些信息可能会有所帮助。
## 缺点
每次在元素层次结构中添加或移除一个类时， 你都要更新所有的访问者。

在访问者同某个元素进行交互时， 它们可能没有访问元素私有成员变量和方法的必要权限。
## 与其他模式的关系
你可以将访问者模式视为[[命令模式]]的加强版本， 其对象可对不同类的多种对象执行操作。

你可以使用访问者对整个[[组合模式]]树执行操作。

可以同时使用访问者和[[迭代器模式]]来遍历复杂数据结构， 并对其中的元素执行所需操作， 即使这些元素所属的类完全不同。