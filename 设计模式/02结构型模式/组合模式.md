组合模式是一种结构型设计模式， 你可以使用它将对象组合成树状结构， 并且能像使用独立对象一样使用它们。
![[组合模式现实世界类别.png]]

有两类对象：  产品和 盒子 。 一个盒子中可以包含多个 产品或者几个较小的 盒子 。 这些小 盒子中同样可以包含一些 产品或更小的 盒子 ， 以此类推。
组合模式建议使用一个通用接口来与 产品和 盒子进行交互， 并且在该接口中声明一个计算总价的方法。

![[组合模式结构.png]]

## 适用场景
如果你需要实现树状对象结构， 可以使用组合模式。

如果你希望客户端代码以相同方式处理简单和复杂元素， 可以使用该模式。
## 实现方式
确保应用的核心模型能够以树状结构表示。 尝试将其分解为简单元素和容器。 记住， 容器必须能够同时包含简单元素和其他容器。

声明组件接口及其一系列方法， 这些方法对简单和复杂元素都有意义。

创建一个叶节点类表示简单元素。 程序中可以有多个不同的叶节点类。

创建一个容器类表示复杂元素。 在该类中， 创建一个数组成员变量来存储对于其子元素的引用。 该数组必须能够同时保存叶节点和容器， 因此请确保将其声明为组合接口类型。

实现组件接口方法时， 记住容器应该将大部分工作交给其子元素来完成。

最后， 在容器中定义添加和删除子元素的方法。

记住， 这些操作可在组件接口中声明。 这将会违反_接口隔离原则_， 因为叶节点类中的这些方法为空。 但是， 这可以让客户端无差别地访问所有元素， 即使是组成树状结构的元素。
## 优点
你可以利用多态和递归机制更方便地使用复杂树结构。

开闭原则。 无需更改现有代码， 你就可以在应用中添加新元素， 使其成为对象树的一部分。
## 缺点
对于功能差异较大的类， 提供公共接口或许会有困难。 在特定情况下， 你需要过度一般化组件接口， 使其变得令人难以理解。
## 与其他模式的关系
[[桥接模式]]、 [[状态模式]]和[[策略模式]] （在某种程度上包括[[适配器模式]]） 模式的接口非常相似。 实际上， 它们都基于组合模式——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。

你可以在创建复杂组合树时使用[[生成器模式]]， 因为这可使其构造步骤以递归的方式运行。

[[责任链模式]]通常和组合模式结合使用。 在这种情况下， 叶组件接收到请求后， 可以将请求沿包含全体父组件的链一直传递至对象树的底部。

你可以使用[[迭代器模式]]来遍历组合树。

你可以使用[[访问者模式]]对整个组合树执行操作。

你可以使用[[享元模式]]实现组合树的共享叶节点以节省内存。

组合和[[装饰模式]]的结构图很相似， 因为两者都依赖递归组合来组织无限数量的对象。

装饰类似于组合， 但其只有一个子组件。 此外还有一个明显不同： 装饰为被封装对象添加了额外的职责， 组合仅对其子节点的结果进行了 “求和”。

但是， 模式也可以相互合作： 你可以使用装饰来扩展组合树中特定对象的行为。

大量使用组合和装饰的设计通常可从对于[[原型模式]]的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。