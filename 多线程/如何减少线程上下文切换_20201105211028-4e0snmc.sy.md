使用多线程时，**不是多线程能提升程序的执行速度**，使用多线程是为了**更好地利用 CPU 资源**！

程序在执行时，多线程是 CPU 通过给每个线程**分配 CPU 时间片来实现**的，时间片是CPU分配给每个线程执行的时间，因时间片非常短，所以**CPU 通过不停地切换线程执行**。

线程**不是越多就越好**的，因为线程上下文切换是有**性能损耗**的，在使用多线程的同时需要考虑如何减少上下文切换

一般来说有以下几条经验

- **无锁并发编程**。多线程竞争时，会引起上下文切换，所以多线程处理数据时，可以用一些办法来避免使用锁，如将数据的 ID 按照Hash取模分段，不同的线程处理不同段的数据
- **CAS算法**。Java 的 Atomic 包使用 CAS 算法来更新数据，**而不需要加锁**。
- **控制线程数量**。避免创建不需要的线程，比如任务很少，但是创建了很多线程来处理，这样会造成大量线程都处于等待状态
- **协程**。在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换
- 协程可以看成是用户态**自管理的“线程”**。**不会参与**CPU时间调度，没有均衡分配到时间。**非抢占式**的

还可以考虑我们的应用是**IO密集型的还是CPU密集型**的。

- 如果是IO密集型的话，线程可以多一些。
- 如果是CPU密集型的话，线程不宜太多。
