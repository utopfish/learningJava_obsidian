#### 对查询语句进行词法分析，语法分析，及语言处理
由于查询语句有语法，因而也要进行语法分析，语法分析及语言处理。
1. 词法分析主要用来识别单词和关键字。
如上述例子中，经过词法分析，得到单词有lucene，learned，hadoop, 关键字有AND, NOT。
如果在词法分析中发现不合法的关键字，则会出现错误。如lucene AMD learned，其中由于AND拼错，导致AMD作为一个普通的单词参与查询。
2. 语法分析主要是根据查询语句的语法规则来形成一棵语法树。
如果发现查询语句不满足语法规则，则会报错。如lucene NOT AND learned，则会出错。
如上述例子，lucene AND learned NOT hadoop形成的语法树如下：
![[语法树.png]]
3. 语言处理同索引过程中的语言处理几乎相同。
如learned变成learn等。
经过第二步，我们得到一棵经过语言处理的语法树。
![[处理后的语法树.png]]
#### 搜索索引，得到符合语法树的文档
此步骤有分几小步：
	1. 在反向索引表中，分别找出包含lucene，learn，hadoop的文档链表。
	2. 对包含lucene，learn的链表进行合并操作，得到既包含lucene又包含learn的文档链表。
	3. 将此链表与hadoop的文档链表进行差操作，去除包含hadoop的文档，从而得到既包含lucene又包含learn而且不包含hadoop的文档链表。
	4. 此文档链表就是我们要找的文档。

#### 根据得到的文档和查询语句的相关性，对结果进行排序
虽然在上一步，我们得到了想要的文档，然而对于查询结果应该按照与查询语句的相关性进行排序，越相关者越靠前。
如何计算文档和查询语句的相关性呢？
不如我们把查询语句看作一片短小的文档，对文档与文档之间的相关性(relevance)进行打分(scoring)，分数高的相关性好，就应该排在前面。

后面太复杂，而文档又讲不清楚，暂时停止排序算法。